<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="SuPQ3DDNV0"><meta name="author" content="Minhui Zheng, mattzhengjob@gmail.com"><title>Promise vs Observables · Minhui's blog</title><meta name="description" content="Difference
Single value vs multiple values
Eager vs lazy
Not cancellable vs cancellable
Multicast vs either unicast or multicast
Always asynchronous v"><meta name="keywords" content="React,Next.js,Svelte,Web,HTML,JavaScript,CSS,Tailwind,Frontend,Angular"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><meta name="og:type" content="blog"><meta name="og:title" content="Minhui's blog"><meta name="og:description" content="I'm Minhui and I share my thoughts about reading, thinking, and web development."><meta name="og:image" content="https://zhengminhui.com/images/og-image-logo.png"><meta name="twitter:card" content="summary"><meta name="twitter:description" content="I'm Minhui and I share my thoughts about reading, thinking, and web development."><meta name="twitter:site" content="https://zhengminhui.com/"><meta name="twitter:creator" content="@minhui"><meta name="twitter:image" content="https://zhengminhui.com/images/og-image-logo.png"><meta name="renderer" content="webkit"><link type="image/png" href="https://zhengminhui.com/images/favicon16.png" rel="icon" size="16x16"><link type="image/png" href="https://zhengminhui.com/images/favicon32.png" rel="icon" size="32x32"><link href="/css/style.css" rel="stylesheet"><link href="/css/blog_basic.css" rel="stylesheet"><link href="/css/font-awesome.min.css" rel="stylesheet"><link type="application/atom+xml" href="/atom.xml" title="ATOM 1.0" rel="alternate"><script src="/_vercel/insights/script.js" defer=""></script><script src="https://www.googletagmanager.com/gtag/js?id=G-36J5NZ3PJY" async=""></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-36J5NZ3PJY');</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo.png" style="width:128px;"><h3 title=""><a href="/">Minhui's blog</a></h3><div class="description"><p>🖖 Live long and prosper.</p></div></div></div><ul class="social-links"><li><a href="https://github.com/zhengminhui" target="_blank"><i class="fa fa-github"></i></a></li><li><a href="http://instagram.com/wanzaiwanger" target="_blank"><i class="fa fa-instagram"></i></a></li><li><a href="http://weibo.com/alandwhatever" target="_blank"><i class="fa fa-weibo"></i></a></li><li><a href="https://twitter.com/wanzaiwanger" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://zhengminhui.com/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li></ul><div class="footer"><span>Theme by CaiCai & Ben</span><div class="by_farbox"><span>Proudly published with Hexo</span></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">Home</a></li><li><a href="/archives">Archive</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Promise vs Observables</a></h3></div><div class="post-content"><h2 id="Difference"><a href="#Difference" class="headerlink" title="Difference"></a>Difference</h2><ul>
<li>Single value vs multiple values</li>
<li>Eager vs lazy</li>
<li>Not cancellable vs cancellable</li>
<li>Multicast vs either unicast or multicast</li>
<li>Always asynchronous vs possibly asynchronous</li>
</ul>
<h2 id="Single-value-vs-multiple-values"><a href="#Single-value-vs-multiple-values" class="headerlink" title="Single value vs multiple values"></a>Single value vs multiple values</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// promise</span></span><br><span class="line"><span class="keyword">const</span> numberPromise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">10</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// prints only 5</span></span><br><span class="line">numberPromise.<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value));</span><br><span class="line"></span><br><span class="line"><span class="comment">// observable</span></span><br><span class="line"><span class="keyword">const</span> numberObservable = <span class="keyword">new</span> <span class="title class_">Observable</span>(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">    observer.<span class="title function_">next</span>(<span class="number">5</span>);</span><br><span class="line">    observer.<span class="title function_">next</span>(<span class="number">10</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// prints 5 and 10</span></span><br><span class="line">numberObservable.<span class="title function_">subscribe</span>(<span class="function"><span class="params">value</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value));</span><br></pre></td></tr></table></figure>

<p>Wrapping <code>setInterval</code> in Observable: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> secondsObservable = <span class="keyword">new</span> <span class="title class_">Observable</span>(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        observer.<span class="title function_">next</span>(i++);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">secondsObservable.<span class="title function_">subscribe</span>(<span class="function"><span class="params">value</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value));</span><br><span class="line"><span class="comment">// logs:</span></span><br><span class="line"><span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// and so on, every second</span></span><br></pre></td></tr></table></figure>

<h2 id="Eager-vs-lazy"><a href="#Eager-vs-lazy" class="headerlink" title="Eager vs lazy"></a>Eager vs lazy</h2><p>For <code>Promise</code>, the <code>executor</code> function is executed immediately by the Promise implementation, passing <code>resolve</code> and <code>reject</code> functions.</p>
<p>For <code>Observable</code>, functions passed to <code>Observable</code> constructor gets called only when someone actually subscribe to an Observable.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// promise print immediately</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;I was called!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observable = <span class="keyword">new</span> <span class="title class_">Observable</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;I was called!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// nothing happens here</span></span><br><span class="line"></span><br><span class="line">observable.<span class="title function_">subscribe</span>();</span><br><span class="line"><span class="comment">// just now &quot;I was called!&quot; gets printed</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> secondsObservable = <span class="keyword">new</span> <span class="title class_">Observable</span>(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        observer.<span class="title function_">next</span>(i++);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Thanks to laziness, <code>setInterval</code> is not called at this point and even <code>i</code> variable is not initiated.</p>
<h2 id="Not-cancellable-vs-cancellable"><a href="#Not-cancellable-vs-cancellable" class="headerlink" title="Not cancellable vs cancellable"></a>Not cancellable vs cancellable</h2><p>ES6 promise do not support <code>cancel</code> method. Some Promise libraries like Bluebird support <code>cancel</code> method.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> secondsObservable = <span class="keyword">new</span> <span class="title class_">Observable</span>(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> token = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        observer.<span class="title function_">next</span>(i++);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(token);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subscription = </span><br><span class="line">    secondsObservable.<span class="title function_">subscribe</span>(<span class="function"><span class="params">value</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value));</span><br><span class="line"></span><br><span class="line">subscription.<span class="title function_">unsubscribe</span>();</span><br></pre></td></tr></table></figure>

<p><code>subscribe</code> doesn’t return Observable! This means you cannot chain several subscribe calls like you would chain <code>then</code> calls in Promises. <code>subscribe</code> returns a Subscription for given Observable. This Subscription has only one method  – <code>unsubscribe</code>  – which you can call, when you decide you don’t want to listen to certain Observable anymore.</p>
<h2 id="Multicast-vs-either-unicast-or-multicast"><a href="#Multicast-vs-either-unicast-or-multicast" class="headerlink" title="Multicast vs either unicast or multicast"></a>Multicast vs either unicast or multicast</h2><p>Promises (because of their eager nature) are always “multicast”. Function passed to Promise constructor is called only when Promise is created and never again (unless you create brand new Promise with that function of course). </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> waitOneSecondPromise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;I was called!&#x27;</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">waitOneSecondPromise.<span class="title function_">then</span>(doSomething);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 500ms passes</span></span><br><span class="line"></span><br><span class="line">waitOneSecondPromise.<span class="title function_">then</span>(doSomethingElse);</span><br><span class="line"><span class="comment">// the console will print only once, and doSomethingElse will be called after only half second.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>That person would naturally expect doSomethingElse to be called exactly one second from the moment it was passed to then, but in that case it would be called after half a second.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> waitOneSecondObservable = <span class="keyword">new</span> <span class="title class_">Observable</span>(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;I was called&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> observer.<span class="title function_">next</span>(), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">waitOneSecondObservable.<span class="title function_">subscribe</span>(doSomething);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 500 ms</span></span><br><span class="line"></span><br><span class="line">waitOneSecondObservable.<span class="title function_">subscribe</span>(doSomethingElse)</span><br></pre></td></tr></table></figure>

<p>Here every call to <code>subscribe</code> will start it’s own clock. Both doSomething and doSomethingElse functions will be called one second from the moment they were passed to <code>subscribe</code>. If you look in the console, you will see <code>&quot;I was called!&quot;</code> printed to console twice, which shows that function passed to <code>Observable</code> constructor was indeed called twice and two instances of <code>setTimeout</code> timer were created.</p>
<p>By using <code>share</code> operator, you can make the <code>Observable</code> perform only once and then share between subscribers.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sharedWaitOneSecondObservable =</span><br><span class="line">    waitOneSecondObservable.<span class="title function_">share</span>();</span><br><span class="line"></span><br><span class="line">sharedWaitOneSecondObservable.<span class="title function_">subscribe</span>(doSomething);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 500 ms passes</span></span><br><span class="line"></span><br><span class="line">sharedWaitOneSecondObservable.<span class="title function_">subscribe</span>(doSomethingElse);</span><br></pre></td></tr></table></figure>

<p>If Observable shares a result between many subscribers, we say it is “multicast”, since it casts single value to multiple entities.</p>
<h2 id="Always-asynchronous-vs-possibly-asynchronous"><a href="#Always-asynchronous-vs-possibly-asynchronous" class="headerlink" title="Always asynchronous vs possibly asynchronous"></a>Always asynchronous vs possibly asynchronous</h2><p>Promise is asynchronous even we call <code>resolve</code> synchronously.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">5</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value + <span class="string">&#x27;!&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;And now we are here.&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>First <code>&quot;And now we are here.&quot;</code> is logged and just then <code>&quot;5!&quot;</code></p>
<p>Observable may emit values synchronously.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observable = <span class="keyword">new</span> <span class="title class_">Observable</span>(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">    observer.<span class="title function_">next</span>(<span class="number">5</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observable.<span class="title function_">subscribe</span>(<span class="function"><span class="params">value</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value + <span class="string">&#x27;!&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;And now we are here.&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>&quot;5!&quot;</code> appears first and just then we see <code>&quot;And now we are here.&quot;</code>.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a target="_blank" rel="noopener" href="https://medium.com/@mpodlasin/promises-vs-observables-4c123c51fe13">promises-vs-observables</a></li>
</ol>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-calendar"></i><span class="date">2019-01-27</span><i class="fa fa-tag"></i><a href="/categories/web/" title="web" class="tag">web </a><a href="/tags/promise/" title="promise" class="tag">promise </a><a href="/tags/ECMAScript2015/" title="ECMAScript2015" class="tag">ECMAScript2015 </a><a href="/tags/es6/" title="es6" class="tag">es6 </a><a href="/tags/Observables/" title="Observables" class="tag">Observables </a><a href="/tags/subscription/" title="subscription" class="tag">subscription </a><a href="/tags/subscribe/" title="subscribe" class="tag">subscribe </a></div></div></div></div><div class="share"><div class="weibo"> <a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"> <a target="_blank" rel="noopener" href="https://twitter.com/intent/tweet?url=https://zhengminhui.com/2019/24019ac5/&amp;text=Promise vs Observables%20·%20Minhui's blog" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2019/c505c167/" title="Node.js modules" class="btn">prev post</a></li><li class="next pagbuttons"><a role="navigation" href="/2018/89c05b44/" title="Decorators in JavaScript" class="btn">next post</a></li></ul></div></div></div></div></div></body></html>